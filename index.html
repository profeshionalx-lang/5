<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Grechka ‚Ä¢ Padel</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    
    <script>
        // Admin email
        const ADMIN_EMAIL = 'profeshionalx@gmail.com';
        
        function initFirebase() {
            try {
                if (typeof firebase === 'undefined') {
                    console.error('Firebase –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω');
                    return;
                }

                const firebaseConfig = {
                    apiKey: "AIzaSyBVKxWXOxVq_9vIpRr7eQCEJOPv7PKImg0",
                    authDomain: "grechka-6bdb7.firebaseapp.com",
                    projectId: "grechka-6bdb7",
                    storageBucket: "grechka-6bdb7.firebasestorage.app",
                    messagingSenderId: "746199017331",
                    appId: "1:746199017331:web:2e4e08023cb89484fd4706"
                };

                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                
                window.firebaseDB = firebase.firestore();
                window.firebaseAuth = firebase.auth();
                window.firebaseGoogleProvider = new firebase.auth.GoogleAuthProvider();
                window.firebaseAppleProvider = new firebase.auth.OAuthProvider('apple.com');
                window.firebaseAppleProvider.addScope('email');
                window.firebaseAppleProvider.addScope('name');
                
                // –•–µ–ª–ø–µ—Ä—ã
                window.firebaseCollection = (db, name) => db.collection(name);
                window.firebaseDoc = (db, col, id) => db.collection(col).doc(id);
                window.firebaseGetDoc = (ref) => ref.get();
                window.firebaseSetDoc = (ref, data, opt) => ref.set(data, opt);
                window.firebaseUpdateDoc = (ref, data) => ref.update(data);
                window.firebaseOnSnapshot = (ref, onNext, onError) => ref.onSnapshot(onNext, onError);
                window.firebaseGetDocs = (ref) => ref.get();
                window.firebaseArrayUnion = firebase.firestore.FieldValue.arrayUnion;
                window.firebaseArrayRemove = firebase.firestore.FieldValue.arrayRemove;
                
                console.log('Firebase initialized');
                window.dispatchEvent(new Event('firebaseReady'));
            } catch (error) {
                console.error('Firebase init error:', error);
            }
        }

        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initFirebase);
        } else {
            initFirebase();
        }
    </script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        function App() {
            const [view, setView] = useState('list');
            const [tournaments, setTournaments] = useState([]);
            const [currentTournament, setCurrentTournament] = useState(null);
            const [activeTab, setActiveTab] = useState('info');
            const [tournamentId, setTournamentId] = useState(null);
            const [firebaseReady, setFirebaseReady] = useState(false);
            const [showShareModal, setShowShareModal] = useState(false);
            const [showAuthModal, setShowAuthModal] = useState(false);
            
            // AUTH STATES
            const [user, setUser] = useState(null);
            const [userProfile, setUserProfile] = useState(null);
            const [isAdmin, setIsAdmin] = useState(false);

            // PLAYERS STATES
            const [players, setPlayers] = useState([]);
            const [selectedPlayer, setSelectedPlayer] = useState(null);
            const [showCreatePlayerModal, setShowCreatePlayerModal] = useState(false);
            const [allPlayers, setAllPlayers] = useState([]);

            useEffect(() => {
                const handleReady = () => setFirebaseReady(true);
                window.addEventListener('firebaseReady', handleReady);
                if (window.firebaseDB) setFirebaseReady(true);
                
                // –ü—Ä–æ–≤–µ—Ä–∫–∞ URL –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
                const urlParams = new URLSearchParams(window.location.search);
                const id = urlParams.get('tournament');
                
                if (id) {
                    setTournamentId(id);
                    if (firebaseReady) loadTournamentFromFirebase(id);
                }

                return () => window.removeEventListener('firebaseReady', handleReady);
            }, [firebaseReady]);

            // AUTH LOGIC
            useEffect(() => {
                if (!firebaseReady) return;

                const unsubscribe = window.firebaseAuth.onAuthStateChanged(async (firebaseUser) => {
                    setUser(firebaseUser);
                    if (firebaseUser) {
                        // Check admin status
                        setIsAdmin(firebaseUser.email === ADMIN_EMAIL);
                        await syncUserWithPlayers(firebaseUser);
                    } else {
                        setUserProfile(null);
                        setIsAdmin(false);
                    }
                });

                return () => unsubscribe();
            }, [firebaseReady]);

            const syncUserWithPlayers = async (authUser) => {
                try {
                    const playerRef = window.firebaseDoc(window.firebaseDB, 'players', authUser.uid);
                    const docSnap = await window.firebaseGetDoc(playerRef);

                    if (docSnap.exists) {
                        setUserProfile(docSnap.data());
                    } else {
                        // –°–æ–∑–¥–∞–µ–º –ø—Ä–æ—Ñ–∏–ª—å –µ—Å–ª–∏ –Ω–µ—Ç
                        const newPlayer = {
                            id: authUser.uid,
                            name: authUser.displayName || '–ò–≥—Ä–æ–∫',
                            email: authUser.email,
                            photoURL: authUser.photoURL,
                            tournamentsPlayed: 0,
                            totalMatches: 0,
                            wins: 0,
                            losses: 0,
                            points: 0,
                            gamesWon: 0,
                            gamesLost: 0,
                            createdAt: new Date().toISOString(),
                            lastUpdated: new Date().toISOString(),
                            tournaments: []
                        };
                        await window.firebaseSetDoc(playerRef, newPlayer);
                        setUserProfile(newPlayer);
                        loadAllPlayers();
                    }
                } catch (e) {
                    console.error("Error syncing user:", e);
                }
            };

            const handleGoogleLogin = async () => {
                try {
                    await window.firebaseAuth.signInWithPopup(window.firebaseGoogleProvider);
                    setShowAuthModal(false);
                } catch (error) {
                    alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞: " + error.message);
                }
            };

            const handleAppleLogin = async () => {
                try {
                    await window.firebaseAuth.signInWithPopup(window.firebaseAppleProvider);
                    setShowAuthModal(false);
                } catch (error) {
                    alert("–û—à–∏–±–∫–∞ –≤—Ö–æ–¥–∞ —á–µ—Ä–µ–∑ Apple: " + error.message);
                }
            };

            const handleLogout = async () => {
                await window.firebaseAuth.signOut();
            };

            // DATA LOADING
            useEffect(() => {
                if (firebaseReady) {
                    loadAllPlayers();
                }
            }, [firebaseReady]);

            const loadAllPlayers = async () => {
                if (!firebaseReady) return;
                const playersRef = window.firebaseCollection(window.firebaseDB, 'players');
                const unsubscribe = window.firebaseOnSnapshot(playersRef, (snapshot) => {
                    const loadedPlayers = [];
                    snapshot.forEach((doc) => loadedPlayers.push(doc.data()));
                    loadedPlayers.sort((a, b) => (b.points || 0) - (a.points || 0));
                    setPlayers(loadedPlayers);
                    setAllPlayers(loadedPlayers);
                });
                return () => unsubscribe();
            };

            // TOURNAMENT LIST LISTENER
            useEffect(() => {
                if (!firebaseReady || tournamentId) return;
                const tournamentsRef = window.firebaseCollection(window.firebaseDB, 'tournaments');
                const unsubscribe = window.firebaseOnSnapshot(tournamentsRef, (snapshot) => {
                    const loaded = [];
                    snapshot.forEach((doc) => {
                        const d = doc.data();
                        if (!d.deleted) loaded.push(d);
                    });
                    // Sort by date (upcoming first)
                    loaded.sort((a, b) => new Date(a.date || a.createdAt) - new Date(b.date || b.createdAt));
                    setTournaments(loaded);
                });
                return () => unsubscribe();
            }, [firebaseReady, tournamentId]);

            // SINGLE TOURNAMENT LISTENER
            useEffect(() => {
                if (!firebaseReady || !tournamentId) return;
                const unsubscribe = window.firebaseOnSnapshot(
                    window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId),
                    (doc) => {
                        if (doc.exists) setCurrentTournament(doc.data());
                    }
                );
                return () => unsubscribe();
            }, [firebaseReady, tournamentId]);

            const loadTournamentFromFirebase = async (id) => {
                const docRef = window.firebaseDoc(window.firebaseDB, 'tournaments', id);
                const docSnap = await window.firebaseGetDoc(docRef);
                if (docSnap.exists) {
                    const data = docSnap.data();
                    setCurrentTournament(data);
                    setView('tournament');
                    setActiveTab('info');
                } else {
                    setView('list');
                }
            };

            // ACTIONS
            const createPlayer = async (playerName) => {
                if (!playerName || !firebaseReady) return;
                const id = playerName.toLowerCase().replace(/\s+/g, '_') + '_' + Date.now().toString().slice(-4);
                const playerRef = window.firebaseDoc(window.firebaseDB, 'players', id);
                
                const newPlayerData = {
                    id: id,
                    name: playerName,
                    tournamentsPlayed: 0,
                    totalMatches: 0,
                    wins: 0,
                    losses: 0,
                    points: 0,
                    createdAt: new Date().toISOString(),
                    lastUpdated: new Date().toISOString(),
                    tournaments: []
                };
                
                await window.firebaseSetDoc(playerRef, newPlayerData);
                return true;
            };

            const createTournament = async (data) => {
                const id = 'tournament_' + Date.now();
                const newT = {
                    id, 
                    ...data, 
                    status: 'upcoming', 
                    deleted: false,
                    createdAt: new Date().toISOString(),
                    registeredPlayers: [],
                    pairs: []
                };
                await window.firebaseSetDoc(window.firebaseDoc(window.firebaseDB, 'tournaments', id), newT);
                
                setCurrentTournament(newT);
                setTournamentId(id);
                setView('tournament');
                setActiveTab('info');
            };

            const registerForTournament = async () => {
                if (!user) {
                    setShowAuthModal(true);
                    return;
                }
                
                if (!currentTournament || !tournamentId) return;
                
                const playerData = {
                    id: user.uid,
                    name: user.displayName || '–ò–≥—Ä–æ–∫',
                    email: user.email,
                    photoURL: user.photoURL,
                    registeredAt: new Date().toISOString()
                };
                
                await window.firebaseUpdateDoc(
                    window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId),
                    { registeredPlayers: window.firebaseArrayUnion(playerData) }
                );
            };

            const unregisterFromTournament = async () => {
                if (!user || !currentTournament || !tournamentId) return;
                
                const playerToRemove = currentTournament.registeredPlayers?.find(p => p.id === user.uid);
                if (playerToRemove) {
                    await window.firebaseUpdateDoc(
                        window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId),
                        { registeredPlayers: window.firebaseArrayRemove(playerToRemove) }
                    );
                }
            };

            const updateMatchResult = async (groupId, matchIdx, result, stage) => {
                const field = stage === 1 ? 'stage1Groups' : 'stage2Groups';
                const groups = [...currentTournament[field]];
                const group = groups[groupId];
                Object.assign(group.matches[matchIdx], result);
                
                // Recalculate
                group.pairs.forEach(p => {
                    p.played = 0; p.points = 0; p.gamesWon = 0; p.gamesLost = 0; p.gamesDiff = 0; p.won = 0; p.lost = 0;
                });
                
                group.matches.forEach(m => {
                    if (m.set1p1 !== '' && m.set1p2 !== '') {
                        const s1 = parseInt(m.set1p1) || 0;
                        const s2 = parseInt(m.set1p2) || 0;
                        const p1 = group.pairs.find(p => p.id === m.pair1.id);
                        const p2 = group.pairs.find(p => p.id === m.pair2.id);
                        
                        if (p1 && p2) {
                            p1.played++; p2.played++;
                            p1.gamesWon += s1; p2.gamesWon += s2;
                            p1.gamesLost += s2; p2.gamesLost += s1;
                            
                            if (s1 > s2) { p1.won++; p2.lost++; p1.points += 3; }
                            else if (s2 > s1) { p2.won++; p1.lost++; p2.points += 3; }
                            
                            p1.gamesDiff = p1.gamesWon - p1.gamesLost;
                            p2.gamesDiff = p2.gamesWon - p2.gamesLost;
                        }
                    }
                });
                
                group.pairs.sort((a, b) => b.points - a.points || b.gamesDiff - a.gamesDiff || b.gamesWon - a.gamesWon);
                
                await window.firebaseUpdateDoc(window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId), {
                    [field]: groups
                });
            };

            const generateGroups = (pairs, courts) => {
                const groups = [];
                const numGroups = Math.ceil(pairs.length / 4);
                let courtsArray = typeof courts === 'number' ?
                    Array(courts).fill().map((_, i) => ({id: i+1, name: `–ö–æ—Ä—Ç ${i+1}`})) : courts;

                for (let i = 0; i < numGroups; i++) {
                    const groupPairs = pairs.slice(i * 4, (i + 1) * 4);
                    const matches = [];
                    if (groupPairs.length === 4) {
                        const c1 = courtsArray[0] || {name: '–ö–æ—Ä—Ç'};
                        const c2 = courtsArray[1] || c1;
                        matches.push(
                            { round: 1, pair1: groupPairs[0], pair2: groupPairs[1], court: c1, set1p1:'', set1p2:'' },
                            { round: 1, pair1: groupPairs[2], pair2: groupPairs[3], court: c2, set1p1:'', set1p2:'' },
                            { round: 2, pair1: groupPairs[0], pair2: groupPairs[2], court: c1, set1p1:'', set1p2:'' },
                            { round: 2, pair1: groupPairs[1], pair2: groupPairs[3], court: c2, set1p1:'', set1p2:'' },
                            { round: 3, pair1: groupPairs[0], pair2: groupPairs[3], court: c1, set1p1:'', set1p2:'' },
                            { round: 3, pair1: groupPairs[1], pair2: groupPairs[2], court: c2, set1p1:'', set1p2:'' }
                        );
                    }
                    groups.push({
                        id: i, name: String.fromCharCode(65 + i),
                        pairs: groupPairs.map(p => ({...p, points:0, gamesDiff:0, gamesWon:0, gamesLost:0, played:0, won:0, lost:0})),
                        matches
                    });
                }
                return groups;
            };

            const startTournament = async () => {
                if (!currentTournament || !isAdmin) return;
                
                // Generate pairs from registered players
                const registeredPlayers = currentTournament.registeredPlayers || [];
                const pairs = [];
                
                for (let i = 0; i < registeredPlayers.length; i += 2) {
                    if (registeredPlayers[i + 1]) {
                        pairs.push({
                            id: i / 2 + 1,
                            number: i / 2 + 1,
                            player1: registeredPlayers[i].name,
                            player2: registeredPlayers[i + 1].name
                        });
                    }
                }
                
                const stage1Groups = generateGroups(pairs, currentTournament.courts || 2);
                
                await window.firebaseUpdateDoc(window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId), {
                    status: 'stage1',
                    pairs: pairs,
                    stage1Groups: stage1Groups
                });
                
                setActiveTab('stage1');
            };

            const generateStage2 = async () => {
                const allPairs = [];
                currentTournament.stage1Groups.forEach(g => allPairs.push(...g.pairs));
                allPairs.sort((a, b) => b.points - a.points || b.gamesDiff - a.gamesDiff || b.gamesWon - a.gamesWon);
                
                const stage2Groups = generateGroups(
                    allPairs.map(p => ({id: p.id, number: p.number, player1: p.player1, player2: p.player2})),
                    currentTournament.courts
                );
                
                await window.firebaseUpdateDoc(window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId), {
                    stage2Groups, status: 'stage2'
                });
                setActiveTab('stage2');
            };

            const isUserRegistered = () => {
                if (!user || !currentTournament) return false;
                return currentTournament.registeredPlayers?.some(p => p.id === user.uid);
            };

            // Filter tournaments
            const upcomingTournaments = tournaments.filter(t => t.status === 'upcoming');
            const activeTournaments = tournaments.filter(t => t.status === 'stage1' || t.status === 'stage2');
            const completedTournaments = tournaments.filter(t => t.status === 'completed');

            if (!firebaseReady) return <div className="min-h-screen bg-gray-900 flex items-center justify-center text-white">–ó–∞–≥—Ä—É–∑–∫–∞...</div>;

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 p-6">
                    <div className="max-w-7xl mx-auto">
                        {/* HEADER */}
                        <div className="mb-8 flex items-center justify-between flex-wrap gap-4">
                            <div onClick={() => { setView('list'); setTournamentId(null); setCurrentTournament(null); window.history.pushState({}, '', window.location.pathname); }} className="cursor-pointer">
                                <h1 className="text-4xl font-bold text-white mb-2">Grechka ‚Ä¢ Padel</h1>
                                <p className="text-gray-400">–¢—É—Ä–Ω–∏—Ä—ã –ø–æ –ø–∞–¥–µ–ª-—Ç–µ–Ω–Ω–∏—Å—É</p>
                            </div>
                            
                            <div className="flex items-center gap-3">
                                {/* AUTH BUTTONS */}
                                {user ? (
                                    <div className="flex items-center gap-3 bg-gray-800 bg-opacity-50 p-2 rounded-2xl border border-gray-700">
                                        {user.photoURL ? (
                                            <img src={user.photoURL} className="w-10 h-10 rounded-full border-2 border-purple-500" />
                                        ) : (
                                            <div className="w-10 h-10 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold">
                                                {user.displayName?.[0] || 'U'}
                                            </div>
                                        )}
                                        <div className="hidden sm:block">
                                            <div className="text-white text-sm font-bold">{user.displayName}</div>
                                            {isAdmin && <div className="text-yellow-400 text-xs">–ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</div>}
                                        </div>
                                        <button onClick={handleLogout} className="text-red-400 hover:text-red-300 text-xs font-bold px-2">
                                            –í—ã–π—Ç–∏
                                        </button>
                                    </div>
                                ) : (
                                    <button
                                        onClick={() => setShowAuthModal(true)}
                                        className="bg-white text-gray-900 px-6 py-3 rounded-2xl font-bold hover:bg-gray-100 transition-all flex items-center gap-2"
                                    >
                                        üîê –í–æ–π—Ç–∏
                                    </button>
                                )}

                                {view === 'list' && (
                                    <button
                                        onClick={() => setView('players')}
                                        className="bg-gradient-to-r from-purple-500 to-pink-500 text-white px-6 py-3 rounded-2xl font-semibold hover:shadow-2xl transition-all"
                                    >
                                        üë• –†–µ–π—Ç–∏–Ω–≥
                                    </button>
                                )}
                                {view === 'players' && !selectedPlayer && (
                                    <button
                                        onClick={() => setView('list')}
                                        className="bg-gray-700 text-white px-6 py-3 rounded-2xl font-semibold hover:bg-gray-600 transition-all"
                                    >
                                        ‚Üê –¢—É—Ä–Ω–∏—Ä—ã
                                    </button>
                                )}
                            </div>
                        </div>

                        {/* MAIN CONTENT */}
                        {view === 'list' && (
                            <TournamentList
                                upcomingTournaments={upcomingTournaments}
                                activeTournaments={activeTournaments}
                                completedTournaments={completedTournaments}
                                onCreateNew={() => setView('create')}
                                onSelectTournament={(t) => { 
                                    loadTournamentFromFirebase(t.id); 
                                    setTournamentId(t.id);
                                    window.history.pushState({}, '', `?tournament=${t.id}`);
                                }}
                                isAdmin={isAdmin}
                                onDeleteTournament={async (id) => {
                                    if(confirm('–£–¥–∞–ª–∏—Ç—å —Ç—É—Ä–Ω–∏—Ä?')) await window.firebaseUpdateDoc(window.firebaseDoc(window.firebaseDB, 'tournaments', id), {deleted:true});
                                }}
                            />
                        )}

                        {view === 'create' && isAdmin && (
                            <CreateTournament
                                onSubmit={createTournament}
                                onCancel={() => setView('list')}
                                allPlayers={allPlayers}
                            />
                        )}

                        {view === 'players' && !selectedPlayer && (
                            <div>
                                {isAdmin && (
                                    <div className="mb-6 flex justify-end">
                                        <button
                                            onClick={() => setShowCreatePlayerModal(true)}
                                            className="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-2xl font-semibold hover:shadow-2xl transition-all"
                                        >
                                            + –î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞
                                        </button>
                                    </div>
                                )}
                                <PlayersRanking
                                    players={players}
                                    onSelectPlayer={(player) => setSelectedPlayer(player)}
                                />
                            </div>
                        )}

                        {view === 'players' && selectedPlayer && (
                            <PlayerProfile
                                player={selectedPlayer}
                                onBack={() => setSelectedPlayer(null)}
                            />
                        )}

                        {view === 'tournament' && currentTournament && (
                            <TournamentDetailView
                                tournament={currentTournament}
                                activeTab={activeTab}
                                onTabChange={setActiveTab}
                                onUpdateMatch={updateMatchResult}
                                onGenerateStage2={generateStage2}
                                onStartTournament={startTournament}
                                onComplete={async () => {
                                    await window.firebaseUpdateDoc(window.firebaseDoc(window.firebaseDB, 'tournaments', tournamentId), {status:'completed'});
                                }}
                                onBack={() => { setView('list'); setTournamentId(null); setCurrentTournament(null); window.history.pushState({}, '', window.location.pathname); }}
                                isAdmin={isAdmin}
                                user={user}
                                isUserRegistered={isUserRegistered()}
                                onRegister={registerForTournament}
                                onUnregister={unregisterFromTournament}
                                onShare={() => setShowShareModal(true)}
                            />
                        )}
                    </div>

                    {/* MODALS */}
                    {showCreatePlayerModal && (
                        <CreatePlayerModal
                            onSubmit={createPlayer}
                            onClose={() => setShowCreatePlayerModal(false)}
                        />
                    )}
                    
                    {showShareModal && currentTournament && (
                        <ShareModal
                            tournamentId={tournamentId}
                            tournamentName={currentTournament?.name}
                            onClose={() => setShowShareModal(false)}
                        />
                    )}

                    {showAuthModal && (
                        <AuthModal
                            onGoogleLogin={handleGoogleLogin}
                            onAppleLogin={handleAppleLogin}
                            onClose={() => setShowAuthModal(false)}
                        />
                    )}
                </div>
            );
        }

        // --- AUTH MODAL ---
        function AuthModal({ onGoogleLogin, onAppleLogin, onClose }) {
            return (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 max-w-md w-full shadow-2xl border border-gray-700" onClick={e => e.stopPropagation()}>
                        <h3 className="text-3xl font-bold text-white mb-2 text-center">–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h3>
                        <p className="text-gray-400 text-center mb-8">–í–æ–π–¥–∏—Ç–µ, —á—Ç–æ–±—ã –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—É—Ä–Ω–∏—Ä</p>
                        
                        <div className="space-y-4">
                            <button
                                onClick={onGoogleLogin}
                                className="w-full bg-white text-gray-900 px-6 py-4 rounded-2xl font-bold hover:bg-gray-100 transition-all flex items-center justify-center gap-3"
                            >
                                <svg className="w-6 h-6" viewBox="0 0 24 24">
                                    <path d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z" fill="#4285F4"/>
                                    <path d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z" fill="#34A853"/>
                                    <path d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z" fill="#FBBC05"/>
                                    <path d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z" fill="#EA4335"/>
                                </svg>
                                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Google
                            </button>

                            <button
                                onClick={onAppleLogin}
                                className="w-full bg-black text-white px-6 py-4 rounded-2xl font-bold hover:bg-gray-900 transition-all flex items-center justify-center gap-3 border border-gray-600"
                            >
                                <svg className="w-6 h-6" viewBox="0 0 24 24" fill="currentColor">
                                    <path d="M17.05 20.28c-.98.95-2.05.8-3.08.35-1.09-.46-2.09-.48-3.24 0-1.44.62-2.2.44-3.06-.35C2.79 15.25 3.51 7.59 9.05 7.31c1.35.07 2.29.74 3.08.8 1.18-.24 2.31-.93 3.57-.84 1.51.12 2.65.72 3.4 1.8-3.12 1.87-2.38 5.98.48 7.13-.57 1.5-1.31 2.99-2.54 4.09l.01-.01zM12.03 7.25c-.15-2.23 1.66-4.07 3.74-4.25.29 2.58-2.34 4.5-3.74 4.25z"/>
                                </svg>
                                –í–æ–π—Ç–∏ —á–µ—Ä–µ–∑ Apple
                            </button>
                        </div>

                        <button onClick={onClose} className="w-full mt-6 text-gray-400 hover:text-white transition-all">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                    </div>
                </div>
            );
        }

        // --- TOURNAMENT LIST ---
        function TournamentList({ upcomingTournaments, activeTournaments, completedTournaments, onCreateNew, onSelectTournament, isAdmin, onDeleteTournament }) {
            return (
                <div className="space-y-8">
                    {isAdmin && (
                        <div className="flex justify-end">
                            <button
                                className="bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-8 py-4 rounded-2xl font-semibold hover:shadow-2xl hover:scale-105 transition-all duration-200"
                                onClick={onCreateNew}
                            >
                                + –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                            </button>
                        </div>
                    )}

                    {/* UPCOMING */}
                    <div>
                        <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                            üóìÔ∏è –ü—Ä–µ–¥—Å—Ç–æ—è—â–∏–µ —Ç—É—Ä–Ω–∏—Ä—ã
                        </h2>
                        {upcomingTournaments.length === 0 ? (
                            <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-12 text-center border border-gray-700">
                                <div className="text-6xl mb-4">üéæ</div>
                                <h3 className="text-xl font-bold text-white mb-2">–ü–æ–∫–∞ –Ω–µ—Ç –ø—Ä–µ–¥—Å—Ç–æ—è—â–∏—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤</h3>
                                <p className="text-gray-400">–°–ª–µ–¥–∏—Ç–µ –∑–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏</p>
                            </div>
                        ) : (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {upcomingTournaments.map(t => (
                                    <TournamentCard key={t.id} tournament={t} onSelect={onSelectTournament} isAdmin={isAdmin} onDelete={onDeleteTournament} />
                                ))}
                            </div>
                        )}
                    </div>

                    {/* ACTIVE */}
                    {activeTournaments.length > 0 && (
                        <div>
                            <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                                üî• –ê–∫—Ç–∏–≤–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {activeTournaments.map(t => (
                                    <TournamentCard key={t.id} tournament={t} onSelect={onSelectTournament} isAdmin={isAdmin} onDelete={onDeleteTournament} isActive />
                                ))}
                            </div>
                        </div>
                    )}

                    {/* COMPLETED */}
                    {completedTournaments.length > 0 && (
                        <div>
                            <h2 className="text-2xl font-bold text-white mb-4 flex items-center gap-2">
                                üèÜ –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ —Ç—É—Ä–Ω–∏—Ä—ã
                            </h2>
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                                {completedTournaments.map(t => (
                                    <TournamentCard key={t.id} tournament={t} onSelect={onSelectTournament} isAdmin={isAdmin} onDelete={onDeleteTournament} isCompleted />
                                ))}
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        function TournamentCard({ tournament, onSelect, isAdmin, onDelete, isActive, isCompleted }) {
            const t = tournament;
            const gradient = isCompleted ? 'from-gray-600 to-gray-700' : isActive ? 'from-orange-500 to-red-500' : 'from-blue-500 to-purple-600';
            
            return (
                <div
                    className={`bg-gradient-to-br ${gradient} rounded-3xl p-6 hover:shadow-2xl transition-all duration-200 relative cursor-pointer group`}
                    onClick={() => onSelect(t)}
                >
                    <h3 className="text-2xl font-bold text-white mb-3">{t.name}</h3>
                    
                    <div className="text-white/80 space-y-2 mb-4">
                        {t.date && (
                            <div className="flex items-center gap-2">
                                <span>üìÖ</span>
                                <span>{new Date(t.date).toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' })}</span>
                            </div>
                        )}
                        {t.time && (
                            <div className="flex items-center gap-2">
                                <span>üïê</span>
                                <span>{t.time}</span>
                            </div>
                        )}
                        {t.location && (
                            <div className="flex items-center gap-2">
                                <span>üìç</span>
                                <span>{t.location}</span>
                            </div>
                        )}
                        {t.price && (
                            <div className="flex items-center gap-2">
                                <span>üí∞</span>
                                <span>{t.price}</span>
                            </div>
                        )}
                        <div className="flex items-center gap-2">
                            <span>üë•</span>
                            <span>{t.registeredPlayers?.length || 0} —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</span>
                        </div>
                    </div>

                    <span className={`inline-block px-4 py-2 rounded-full text-sm font-bold ${
                        isCompleted ? 'bg-gray-400 text-gray-900' : 
                        isActive ? 'bg-yellow-400 text-yellow-900' : 
                        'bg-green-400 text-green-900'
                    }`}>
                        {isCompleted ? '‚úì –ó–∞–≤–µ—Ä—à—ë–Ω' : isActive ? 'üî• –ò–¥—ë—Ç –∏–≥—Ä–∞' : 'üìù –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è'}
                    </span>

                    {isAdmin && (
                        <button
                            onClick={(e) => {e.stopPropagation(); onDelete(t.id);}}
                            className="absolute top-4 right-4 bg-red-500/80 text-white p-2 rounded-lg opacity-0 group-hover:opacity-100 transition-opacity"
                        >
                            üóë
                        </button>
                    )}
                </div>
            );
        }

        // --- CREATE TOURNAMENT ---
        function CreateTournament({ onSubmit, onCancel }) {
            const [name, setName] = useState('');
            const [date, setDate] = useState('');
            const [time, setTime] = useState('');
            const [location, setLocation] = useState('');
            const [price, setPrice] = useState('');
            const [maxPlayers, setMaxPlayers] = useState(16);
            const [courts, setCourts] = useState(2);
            const [description, setDescription] = useState('');

            return (
                <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 border border-gray-700">
                    <h2 className="text-3xl font-bold text-white mb-8">–°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π —Ç—É—Ä–Ω–∏—Ä</h2>
                    <div className="space-y-6">
                        <div>
                            <label className="block font-semibold mb-3 text-gray-300">–ù–∞–∑–≤–∞–Ω–∏–µ —Ç—É—Ä–Ω–∏—Ä–∞ *</label>
                            <input
                                type="text" 
                                className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none"
                                value={name} 
                                onChange={(e) => setName(e.target.value)} 
                                placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: Sunday Cup"
                            />
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–î–∞—Ç–∞ *</label>
                                <input 
                                    type="date" 
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none"
                                    value={date} 
                                    onChange={(e) => setDate(e.target.value)} 
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–í—Ä–µ–º—è</label>
                                <input 
                                    type="time" 
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none"
                                    value={time} 
                                    onChange={(e) => setTime(e.target.value)} 
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block font-semibold mb-3 text-gray-300">–õ–æ–∫–∞—Ü–∏—è *</label>
                            <input
                                type="text" 
                                className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none"
                                value={location} 
                                onChange={(e) => setLocation(e.target.value)} 
                                placeholder="–ê–¥—Ä–µ—Å –∏–ª–∏ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–ª—É–±–∞"
                            />
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–°—Ç–æ–∏–º–æ—Å—Ç—å</label>
                                <input
                                    type="text" 
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none"
                                    value={price} 
                                    onChange={(e) => setPrice(e.target.value)} 
                                    placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: 1500‚ÇΩ"
                                />
                            </div>
                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–ú–∞–∫—Å. —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤</label>
                                <select 
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white" 
                                    value={maxPlayers} 
                                    onChange={(e) => setMaxPlayers(parseInt(e.target.value))}
                                >
                                    <option value={8}>8</option>
                                    <option value={12}>12</option>
                                    <option value={16}>16</option>
                                    <option value={24}>24</option>
                                    <option value={32}>32</option>
                                </select>
                            </div>
                            <div>
                                <label className="block font-semibold mb-3 text-gray-300">–ö–æ—Ä—Ç–æ–≤</label>
                                <input 
                                    type="number" 
                                    className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white" 
                                    value={courts} 
                                    onChange={(e) => setCourts(parseInt(e.target.value))} 
                                    min="1"
                                    max="10"
                                />
                            </div>
                        </div>

                        <div>
                            <label className="block font-semibold mb-3 text-gray-300">–û–ø–∏—Å–∞–Ω–∏–µ</label>
                            <textarea
                                className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white focus:border-blue-500 outline-none h-32"
                                value={description} 
                                onChange={(e) => setDescription(e.target.value)} 
                                placeholder="–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ç—É—Ä–Ω–∏—Ä–µ..."
                            />
                        </div>

                        <div className="flex gap-4 pt-4">
                            <button 
                                onClick={() => onSubmit({ name, date, time, location, price, maxPlayers, courts, description })} 
                                disabled={!name || !date || !location}
                                className="flex-1 bg-gradient-to-r from-emerald-500 to-teal-500 text-white px-8 py-4 rounded-2xl font-bold hover:shadow-2xl transition-all disabled:opacity-50 disabled:cursor-not-allowed"
                            >
                                –°–æ–∑–¥–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                            </button>
                            <button 
                                onClick={onCancel} 
                                className="px-8 py-4 bg-gray-700 text-white rounded-2xl font-bold hover:bg-gray-600 transition-all"
                            >
                                –û—Ç–º–µ–Ω–∞
                            </button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- TOURNAMENT DETAIL VIEW ---
        function TournamentDetailView({ tournament, activeTab, onTabChange, onUpdateMatch, isAdmin, onBack, onGenerateStage2, onComplete, onStartTournament, user, isUserRegistered, onRegister, onUnregister, onShare }) {
            const isUpcoming = tournament.status === 'upcoming';
            const isActive = tournament.status === 'stage1' || tournament.status === 'stage2';
            const isCompleted = tournament.status === 'completed';

            return (
                <div>
                    {/* HEADER */}
                    <div className="flex items-center justify-between gap-4 mb-6 flex-wrap">
                        <div className="flex items-center gap-4">
                            <button onClick={onBack} className="bg-gray-700 text-white px-4 py-2 rounded-xl font-bold hover:bg-gray-600 transition-all">
                                ‚Üê
                            </button>
                            <h2 className="text-3xl font-bold text-white">{tournament.name}</h2>
                        </div>
                        <button
                            onClick={onShare}
                            className="bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-3 rounded-2xl font-semibold hover:shadow-2xl transition-all flex items-center gap-2"
                        >
                            üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è
                        </button>
                    </div>

                    {/* TABS */}
                    <div className="flex gap-3 mb-8 overflow-x-auto pb-2">
                        <button 
                            onClick={() => onTabChange('info')} 
                            className={`px-6 py-3 font-bold rounded-2xl whitespace-nowrap transition-all ${activeTab === 'info' ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' : 'bg-gray-700 text-gray-300'}`}
                        >
                            üìã –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
                        </button>
                        {(isActive || isCompleted) && (
                            <>
                                <button 
                                    onClick={() => onTabChange('stage1')} 
                                    className={`px-6 py-3 font-bold rounded-2xl whitespace-nowrap transition-all ${activeTab === 'stage1' ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' : 'bg-gray-700 text-gray-300'}`}
                                >
                                    –≠—Ç–∞–ø 1
                                </button>
                                <button 
                                    onClick={() => onTabChange('table1')} 
                                    className={`px-6 py-3 font-bold rounded-2xl whitespace-nowrap transition-all ${activeTab === 'table1' ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' : 'bg-gray-700 text-gray-300'}`}
                                >
                                    –¢–∞–±–ª–∏—Ü–∞
                                </button>
                            </>
                        )}
                        {tournament.stage2Groups && (
                            <>
                                <button 
                                    onClick={() => onTabChange('stage2')} 
                                    className={`px-6 py-3 font-bold rounded-2xl whitespace-nowrap transition-all ${activeTab === 'stage2' ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' : 'bg-gray-700 text-gray-300'}`}
                                >
                                    –≠—Ç–∞–ø 2
                                </button>
                                <button 
                                    onClick={() => onTabChange('final')} 
                                    className={`px-6 py-3 font-bold rounded-2xl whitespace-nowrap transition-all ${activeTab === 'final' ? 'bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg' : 'bg-gray-700 text-gray-300'}`}
                                >
                                    –§–∏–Ω–∞–ª
                                </button>
                            </>
                        )}
                    </div>

                    {/* TAB CONTENT */}
                    {activeTab === 'info' && (
                        <TournamentInfo 
                            tournament={tournament}
                            isAdmin={isAdmin}
                            user={user}
                            isUserRegistered={isUserRegistered}
                            onRegister={onRegister}
                            onUnregister={onUnregister}
                            onStartTournament={onStartTournament}
                        />
                    )}
                    {activeTab === 'stage1' && tournament.stage1Groups && (
                        <StageView groups={tournament.stage1Groups} stage={1} onUpdateMatch={onUpdateMatch} isAdmin={isAdmin} />
                    )}
                    {activeTab === 'table1' && tournament.stage1Groups && (
                        <OverallTable groups={tournament.stage1Groups} onGenerateStage2={onGenerateStage2} showButton={isAdmin && !tournament.stage2Groups} />
                    )}
                    {activeTab === 'stage2' && tournament.stage2Groups && (
                        <StageView groups={tournament.stage2Groups} stage={2} onUpdateMatch={onUpdateMatch} isAdmin={isAdmin} />
                    )}
                    {activeTab === 'final' && tournament.stage2Groups && (
                        <FinalTable groups={tournament.stage2Groups} onComplete={onComplete} isCompleted={isCompleted} isAdmin={isAdmin} />
                    )}
                </div>
            );
        }

        // --- TOURNAMENT INFO ---
        function TournamentInfo({ tournament, isAdmin, user, isUserRegistered, onRegister, onUnregister, onStartTournament }) {
            const isUpcoming = tournament.status === 'upcoming';
            const registeredPlayers = tournament.registeredPlayers || [];

            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {/* LEFT - INFO */}
                    <div className="space-y-6">
                        <div className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-8 shadow-2xl">
                            <h3 className="text-2xl font-bold text-white mb-6">üìã –î–µ—Ç–∞–ª–∏ —Ç—É—Ä–Ω–∏—Ä–∞</h3>
                            
                            <div className="space-y-4 text-white">
                                {tournament.date && (
                                    <div className="flex items-center gap-4 bg-white/20 rounded-2xl p-4">
                                        <span className="text-3xl">üìÖ</span>
                                        <div>
                                            <div className="text-sm opacity-80">–î–∞—Ç–∞</div>
                                            <div className="text-xl font-bold">
                                                {new Date(tournament.date).toLocaleDateString('ru-RU', { 
                                                    weekday: 'long', 
                                                    day: 'numeric', 
                                                    month: 'long',
                                                    year: 'numeric'
                                                })}
                                            </div>
                                        </div>
                                    </div>
                                )}
                                
                                {tournament.time && (
                                    <div className="flex items-center gap-4 bg-white/20 rounded-2xl p-4">
                                        <span className="text-3xl">üïê</span>
                                        <div>
                                            <div className="text-sm opacity-80">–í—Ä–µ–º—è</div>
                                            <div className="text-xl font-bold">{tournament.time}</div>
                                        </div>
                                    </div>
                                )}
                                
                                {tournament.location && (
                                    <div className="flex items-center gap-4 bg-white/20 rounded-2xl p-4">
                                        <span className="text-3xl">üìç</span>
                                        <div>
                                            <div className="text-sm opacity-80">–õ–æ–∫–∞—Ü–∏—è</div>
                                            <div className="text-xl font-bold">{tournament.location}</div>
                                        </div>
                                    </div>
                                )}
                                
                                {tournament.price && (
                                    <div className="flex items-center gap-4 bg-white/20 rounded-2xl p-4">
                                        <span className="text-3xl">üí∞</span>
                                        <div>
                                            <div className="text-sm opacity-80">–°—Ç–æ–∏–º–æ—Å—Ç—å</div>
                                            <div className="text-xl font-bold">{tournament.price}</div>
                                        </div>
                                    </div>
                                )}

                                <div className="flex items-center gap-4 bg-white/20 rounded-2xl p-4">
                                    <span className="text-3xl">üë•</span>
                                    <div>
                                        <div className="text-sm opacity-80">–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤</div>
                                        <div className="text-xl font-bold">
                                            {registeredPlayers.length} / {tournament.maxPlayers || '‚àû'}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            {tournament.description && (
                                <div className="mt-6 bg-white/10 rounded-2xl p-4">
                                    <div className="text-sm opacity-80 mb-2">–û–ø–∏—Å–∞–Ω–∏–µ</div>
                                    <p className="text-white">{tournament.description}</p>
                                </div>
                            )}
                        </div>

                        {/* REGISTRATION BUTTON */}
                        {isUpcoming && (
                            <div className="space-y-4">
                                {isUserRegistered ? (
                                    <button
                                        onClick={onUnregister}
                                        className="w-full bg-red-500 hover:bg-red-600 text-white px-8 py-4 rounded-2xl font-bold transition-all"
                                    >
                                        ‚ùå –û—Ç–º–µ–Ω–∏—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
                                    </button>
                                ) : (
                                    <button
                                        onClick={onRegister}
                                        className="w-full bg-gradient-to-r from-green-500 to-emerald-500 text-white px-8 py-4 rounded-2xl font-bold hover:shadow-2xl hover:scale-105 transition-all text-xl"
                                    >
                                        ‚úÖ –ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Ç—É—Ä–Ω–∏—Ä
                                    </button>
                                )}

                                {isAdmin && registeredPlayers.length >= 4 && (
                                    <button
                                        onClick={onStartTournament}
                                        className="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-4 rounded-2xl font-bold hover:shadow-2xl transition-all"
                                    >
                                        üöÄ –ù–∞—á–∞—Ç—å —Ç—É—Ä–Ω–∏—Ä
                                    </button>
                                )}
                            </div>
                        )}
                    </div>

                    {/* RIGHT - PARTICIPANTS */}
                    <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 border border-gray-700">
                        <h3 className="text-2xl font-bold text-white mb-6">üë• –£—á–∞—Å—Ç–Ω–∏–∫–∏ ({registeredPlayers.length})</h3>
                        
                        {registeredPlayers.length === 0 ? (
                            <div className="text-center py-12">
                                <div className="text-6xl mb-4">üéæ</div>
                                <p className="text-gray-400">–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –∑–∞–ø–∏—Å–∞–ª—Å—è</p>
                                <p className="text-gray-500 text-sm mt-2">–ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>
                            </div>
                        ) : (
                            <div className="space-y-3 max-h-96 overflow-y-auto">
                                {registeredPlayers.map((player, index) => (
                                    <div key={player.id} className="flex items-center gap-4 bg-gray-700/50 rounded-2xl p-4">
                                        <div className="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-500 rounded-full flex items-center justify-center text-white font-bold">
                                            {index + 1}
                                        </div>
                                        {player.photoURL ? (
                                            <img src={player.photoURL} className="w-12 h-12 rounded-full border-2 border-purple-500" />
                                        ) : (
                                            <div className="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center text-white font-bold text-xl">
                                                {player.name?.[0] || '?'}
                                            </div>
                                        )}
                                        <div className="flex-1">
                                            <div className="text-white font-bold">{player.name}</div>
                                            <div className="text-gray-400 text-sm">
                                                {new Date(player.registeredAt).toLocaleDateString('ru-RU')}
                                            </div>
                                        </div>
                                        {user && player.id === user.uid && (
                                            <span className="bg-green-500/20 text-green-400 px-3 py-1 rounded-full text-sm font-bold">
                                                –í—ã
                                            </span>
                                        )}
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );
        }

        // --- PLAYERS RANKING ---
        function PlayersRanking({ players, onSelectPlayer }) {
            return (
                <div className="space-y-6">
                    <div className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-3xl p-8 shadow-2xl">
                        <h2 className="text-4xl font-black text-white mb-2">üë• –†–ï–ô–¢–ò–ù–ì –ò–ì–†–û–ö–û–í</h2>
                        <p className="text-white text-opacity-80">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Å–µ—Ö —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ —Ç—É—Ä–Ω–∏—Ä–æ–≤</p>
                    </div>
                    {players.length === 0 ? (
                        <div className="bg-white rounded-3xl p-12 text-center">
                            <div className="text-6xl mb-4">üéæ</div>
                            <h3 className="text-2xl font-bold text-gray-900">–ü–æ–∫–∞ –ø—É—Å—Ç–æ</h3>
                        </div>
                    ) : (
                        <div className="grid gap-4">
                            {players.map((player, index) => {
                                const rankColor = index === 0 ? 'from-yellow-400 to-yellow-600' : index === 1 ? 'from-gray-300 to-gray-500' : index === 2 ? 'from-orange-400 to-orange-600' : 'from-blue-500 to-purple-600';
                                const winRate = player.totalMatches > 0 ? Math.round((player.wins / player.totalMatches) * 100) : 0;
                                return (
                                    <div key={player.id} onClick={() => onSelectPlayer(player)} className="bg-white rounded-2xl p-6 shadow-lg hover:shadow-2xl transition-all cursor-pointer transform hover:scale-[1.02]">
                                        <div className="flex items-center gap-6">
                                            <div className={`w-16 h-16 rounded-full bg-gradient-to-br ${rankColor} flex items-center justify-center text-white text-2xl font-black`}>{index + 1}</div>
                                            {player.photoURL && <img src={player.photoURL} className="w-16 h-16 rounded-full object-cover" />}
                                            <div className="flex-1 min-w-0">
                                                <h3 className="text-2xl font-bold text-gray-900 truncate mb-1">{player.name}</h3>
                                                <div className="flex flex-wrap gap-4 text-sm text-gray-600">
                                                    <span>–¢—É—Ä–Ω–∏—Ä—ã: <b>{player.tournamentsPlayed || 0}</b></span>
                                                    <span>–ú–∞—Ç—á–∏: <b>{player.totalMatches || 0}</b></span>
                                                    <span className="text-green-600 font-bold">{winRate}% Win</span>
                                                </div>
                                            </div>
                                            <div className="text-right">
                                                <div className="text-3xl font-black text-purple-600">{player.points || 0}</div>
                                                <div className="text-sm text-gray-600">–æ—á–∫–æ–≤</div>
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    )}
                </div>
            );
        }

        // --- PLAYER PROFILE ---
        function PlayerProfile({ player, onBack }) {
            const winRate = player.totalMatches > 0 ? ((player.wins / player.totalMatches) * 100).toFixed(1) : 0;
            return (
                <div className="space-y-6">
                    <button onClick={onBack} className="bg-gray-700 text-white px-6 py-3 rounded-2xl font-semibold hover:bg-gray-600 transition-all">‚Üê –ù–∞–∑–∞–¥</button>
                    <div className="bg-gradient-to-br from-purple-600 to-pink-600 rounded-3xl p-8 shadow-2xl text-white">
                        <div className="flex items-center gap-6 mb-6">
                            {player.photoURL ? <img src={player.photoURL} className="w-24 h-24 rounded-full border-4 border-white/30" /> : <div className="w-24 h-24 bg-white/20 rounded-full flex items-center justify-center text-5xl">üë§</div>}
                            <div><h2 className="text-4xl font-black">{player.name}</h2></div>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
                            {['–¢—É—Ä–Ω–∏—Ä–æ–≤', '–ú–∞—Ç—á–µ–π', '–û—á–∫–æ–≤', '–í–∏–Ω—Ä–µ–π—Ç'].map((label, i) => (
                                <div key={label} className="bg-white/20 rounded-2xl p-4 text-center">
                                    <div className="text-4xl font-black">{[player.tournamentsPlayed||0, player.totalMatches||0, player.points||0, winRate+'%'][i]}</div>
                                    <div className="opacity-80 text-sm">{label}</div>
                                </div>
                            ))}
                        </div>
                    </div>
                </div>
            );
        }

        // --- CREATE PLAYER MODAL ---
        function CreatePlayerModal({ onSubmit, onClose }) {
            const [name, setName] = useState('');
            return (
                <div className="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 max-w-md w-full shadow-2xl border border-gray-700" onClick={e => e.stopPropagation()}>
                        <h3 className="text-3xl font-bold text-white mb-6">–î–æ–±–∞–≤–∏—Ç—å –∏–≥—Ä–æ–∫–∞</h3>
                        <input autoFocus type="text" className="w-full p-4 bg-gray-700 border-2 border-gray-600 rounded-2xl text-white mb-6" value={name} onChange={e => setName(e.target.value)} placeholder="–ò–º—è –∏–≥—Ä–æ–∫–∞" />
                        <div className="flex gap-4">
                            <button onClick={() => { onSubmit(name); onClose(); }} className="flex-1 bg-gradient-to-r from-green-500 to-emerald-500 text-white px-6 py-4 rounded-2xl font-bold">–°–æ–∑–¥–∞—Ç—å</button>
                            <button onClick={onClose} className="px-6 py-4 bg-gray-700 text-white rounded-2xl font-bold">–û—Ç–º–µ–Ω–∞</button>
                        </div>
                    </div>
                </div>
            );
        }

        // --- STAGE VIEW ---
        function StageView({ groups, stage, onUpdateMatch, isAdmin }) {
            const colors = ['from-rose-500 to-pink-500', 'from-blue-500 to-cyan-500', 'from-emerald-500 to-teal-500', 'from-purple-500 to-indigo-500'];
            return (
                <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    {groups.map((group, idx) => (
                        <div key={group.id} className={`bg-gradient-to-br ${colors[idx % 4]} rounded-3xl p-6 shadow-2xl`}>
                            <div className="text-3xl font-black text-white mb-6 text-center">–ì–†–£–ü–ü–ê {group.name}</div>
                            <div className="bg-white/20 backdrop-blur-sm rounded-2xl p-4 mb-6">
                                <table className="w-full text-white text-sm">
                                    <thead><tr><th className="p-2 text-left">–ü–∞—Ä–∞</th><th className="p-2">–ò</th><th className="p-2">–û</th></tr></thead>
                                    <tbody>
                                        {group.pairs.map((p, i) => (
                                            <tr key={i} className="border-b border-white/20">
                                                <td className="p-2 font-bold">#{p.number} <span className="text-xs font-normal opacity-80">{p.player1}/{p.player2}</span></td>
                                                <td className="p-2 text-center">{p.played}</td>
                                                <td className="p-2 text-center font-black text-lg">{p.points}</td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                            <div className="space-y-2">
                                {group.matches.map((m, mIdx) => (
                                    <div key={mIdx} className="bg-white/20 rounded-xl p-2 flex justify-between items-center">
                                        <div className="text-white text-xs opacity-80">{m.court.name}</div>
                                        <div className="text-white font-bold text-sm">#{m.pair1.number} vs #{m.pair2.number}</div>
                                        {isAdmin ? (
                                            <div className="flex gap-1">
                                                <input type="number" className="w-8 h-8 bg-white/30 text-white text-center rounded font-bold" value={m.set1p1} onChange={e => onUpdateMatch(group.id, mIdx, {set1p1: e.target.value}, stage)} />
                                                <span className="text-white">:</span>
                                                <input type="number" className="w-8 h-8 bg-white/30 text-white text-center rounded font-bold" value={m.set1p2} onChange={e => onUpdateMatch(group.id, mIdx, {set1p2: e.target.value}, stage)} />
                                            </div>
                                        ) : <div className="text-white font-black">{m.set1p1}:{m.set1p2}</div>}
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        }

        // --- OVERALL TABLE ---
        function OverallTable({ groups, onGenerateStage2, showButton }) {
            const allPairs = [];
            groups.forEach(g => g.pairs.forEach(p => allPairs.push({...p, group: g.name})));
            allPairs.sort((a, b) => b.points - a.points || b.gamesDiff - a.gamesDiff || b.gamesWon - a.gamesWon);
            return (
                <div className="bg-gradient-to-br from-blue-500 to-purple-600 rounded-3xl p-8 shadow-2xl">
                    <h3 className="text-3xl font-black text-white mb-6">–û–ë–©–ê–Ø –¢–ê–ë–õ–ò–¶–ê</h3>
                    <div className="bg-white/20 rounded-2xl overflow-hidden mb-6">
                        <table className="w-full text-white">
                            <thead><tr className="border-b border-white/30"><th className="p-4 text-left">#</th><th className="p-4 text-left">–ì—Ä</th><th className="p-4 text-left">–ü–∞—Ä–∞</th><th className="p-4 text-center">–û</th><th className="p-4 text-center">+/-</th></tr></thead>
                            <tbody>
                                {allPairs.map((p, i) => (
                                    <tr key={i} className="border-b border-white/20">
                                        <td className="p-4 font-black text-xl">{i+1}</td>
                                        <td className="p-4 font-bold">{p.group}</td>
                                        <td className="p-4">#{p.number} <span className="text-sm opacity-80">{p.player1}/{p.player2}</span></td>
                                        <td className="p-4 text-center font-black text-xl">{p.points}</td>
                                        <td className="p-4 text-center font-bold">{p.gamesDiff > 0 ? '+'+p.gamesDiff : p.gamesDiff}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {showButton && <button onClick={onGenerateStage2} className="w-full bg-white text-purple-600 px-8 py-4 rounded-2xl font-black text-lg hover:shadow-2xl hover:scale-105 transition-all">–ü–ï–†–ï–ô–¢–ò –ö –≠–¢–ê–ü–£ 2 ‚Üí</button>}
                </div>
            );
        }

        // --- FINAL TABLE ---
        function FinalTable({ groups, onComplete, isCompleted, isAdmin }) {
            const finalPairs = [];
            groups.forEach((g, gi) => {
                const sorted = [...g.pairs].sort((a,b) => b.points - a.points);
                sorted.forEach((p, pi) => finalPairs.push({...p, place: gi*4 + pi + 1}));
            });
            finalPairs.sort((a, b) => a.place - b.place);

            return (
                <div className="bg-gradient-to-br from-yellow-500 via-orange-500 to-red-500 rounded-3xl p-8 shadow-2xl">
                    <h3 className="text-4xl font-black text-white mb-6 text-center">üèÜ –§–ò–ù–ê–õ</h3>
                    <div className="bg-white/20 rounded-2xl overflow-hidden mb-6">
                        <table className="w-full text-white">
                            <tbody>
                                {finalPairs.map(p => (
                                    <tr key={p.id} className="border-b border-white/20">
                                        <td className="p-4 font-black text-2xl w-16">{p.place}</td>
                                        <td className="p-4 font-bold text-xl">#{p.number}</td>
                                        <td className="p-4">{p.player1}/{p.player2}</td>
                                        <td className="p-4 text-right font-black text-2xl">{p.points}</td>
                                    </tr>
                                ))}
                            </tbody>
                        </table>
                    </div>
                    {isAdmin && !isCompleted && <button onClick={onComplete} className="w-full bg-white text-orange-600 px-8 py-4 rounded-2xl font-black text-lg hover:scale-105 transition-all">‚úì –ó–ê–í–ï–†–®–ò–¢–¨</button>}
                    {isCompleted && <div className="text-center text-white text-3xl font-black py-8">–¢–£–†–ù–ò–† –ó–ê–í–ï–†–®–Å–ù!</div>}
                </div>
            );
        }

        // --- SHARE MODAL ---
        function ShareModal({ tournamentId, tournamentName, onClose }) {
            const link = `${window.location.origin}${window.location.pathname}?tournament=${tournamentId}`;
            const [copied, setCopied] = useState(false);

            const copyLink = () => {
                navigator.clipboard.writeText(link);
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
            };

            const shareWhatsApp = () => {
                window.open(`https://wa.me/?text=${encodeURIComponent(`üéæ ${tournamentName}\n\n–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ —Ç—É—Ä–Ω–∏—Ä—É –ø–æ –ø–∞–¥–µ–ª-—Ç–µ–Ω–Ω–∏—Å—É!\n\n${link}`)}`, '_blank');
            };

            const shareTelegram = () => {
                window.open(`https://t.me/share/url?url=${encodeURIComponent(link)}&text=${encodeURIComponent(`üéæ ${tournamentName}\n\n–ü—Ä–∏—Å–æ–µ–¥–∏–Ω—è–π—Å—è –∫ —Ç—É—Ä–Ω–∏—Ä—É –ø–æ –ø–∞–¥–µ–ª-—Ç–µ–Ω–Ω–∏—Å—É!`)}`, '_blank');
            };

            return (
                <div className="fixed inset-0 bg-black/70 flex items-center justify-center z-50 p-4" onClick={onClose}>
                    <div className="bg-gradient-to-br from-gray-800 to-gray-900 rounded-3xl p-8 max-w-lg w-full border border-gray-700" onClick={e => e.stopPropagation()}>
                        <h3 className="text-2xl font-bold text-white mb-2">üì§ –ü–æ–¥–µ–ª–∏—Ç—å—Å—è —Ç—É—Ä–Ω–∏—Ä–æ–º</h3>
                        <p className="text-gray-400 mb-6">{tournamentName}</p>
                        
                        <div className="bg-gray-700 p-4 rounded-xl break-all font-mono text-sm text-white mb-6">{link}</div>
                        
                        <div className="grid grid-cols-3 gap-4 mb-6">
                            <button 
                                onClick={copyLink} 
                                className={`p-4 rounded-2xl font-bold transition-all ${copied ? 'bg-green-500 text-white' : 'bg-gray-700 text-white hover:bg-gray-600'}`}
                            >
                                {copied ? '‚úì' : 'üìã'}<br/>
                                <span className="text-sm">{copied ? '–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!' : '–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å'}</span>
                            </button>
                            <button 
                                onClick={shareWhatsApp} 
                                className="bg-green-600 hover:bg-green-700 text-white p-4 rounded-2xl font-bold transition-all"
                            >
                                üí¨<br/>
                                <span className="text-sm">WhatsApp</span>
                            </button>
                            <button 
                                onClick={shareTelegram} 
                                className="bg-blue-500 hover:bg-blue-600 text-white p-4 rounded-2xl font-bold transition-all"
                            >
                                ‚úàÔ∏è<br/>
                                <span className="text-sm">Telegram</span>
                            </button>
                        </div>

                        <button onClick={onClose} className="w-full bg-gray-700 text-white py-3 rounded-xl font-bold hover:bg-gray-600 transition-all">
                            –ó–∞–∫—Ä—ã—Ç—å
                        </button>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
